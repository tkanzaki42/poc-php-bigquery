## âœ… gcloud ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ï¼ˆJSONï¼‰ã‚’å–å¾—ã™ã‚‹æ‰‹é †
### ğŸ”§ å‰æ
* `gcloud` CLI ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿
* å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹
```sh
export YOUR_PROJECT_ID=your-gcloud-project-id
gcloud config set project $YOUR_PROJECT_ID
```
---
### âœ… ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
```sh
gcloud iam service-accounts create bigquery-access \
  --description="BigQuery access for PHP app" \
  --display-name="BigQuery Access"
```
---
### âœ… ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šæ¨©é™ï¼ˆãƒ­ãƒ¼ãƒ«ï¼‰ã‚’ä»˜ä¸
```sh
gcloud projects add-iam-policy-binding $YOUR_PROJECT_ID \
  --member="serviceAccount:bigquery-access@${YOUR_PROJECT_ID}.iam.gserviceaccount.com" \
  --role="roles/bigquery.user"
```
â€» `roles/bigquery.user` ã¯èª­ã¿å–ã‚Šç”¨ã€‚æ›¸ãè¾¼ã¿ã‚‚ã—ãŸã‘ã‚Œã° `roles/bigquery.dataEditor` ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
---
### âœ… ã‚¹ãƒ†ãƒƒãƒ— 3ï¼šJSON ã‚­ãƒ¼ã‚’ä½œæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```sh
gcloud iam service-accounts keys create ./key.json \
  --iam-account=bigquery-access@${YOUR_PROJECT_ID}.iam.gserviceaccount.com
```
â†’ ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `key.json` ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ PHP ã§ `GOOGLE_APPLICATION_CREDENTIALS` ã«æŒ‡å®šã—ã¾ã™ã€‚
---
### âœ… ã¾ã¨ã‚
* `./key.json` ãŒæ‰‹ã«å…¥ã‚Œã°ã€PHP å´ã¯ä»¥ä¸‹ã§èªè¨¼ã§ãã¾ã™ï¼š
```php
putenv('GOOGLE_APPLICATION_CREDENTIALS=' . __DIR__ . '/key.json');
```
